{% extends "base.html" %}
{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è{% endblock %}
{% block content %}
<div class="header">
    <h2>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è: {{ user.name }}</h2>
    <a href="{% url 'user_profile' user.id %}" class="btn btn-secondary">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
</div>

<div class="user-card">
    <h3>üìù –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
    <form method="post" id="editForm">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="{{ user_form.name.id_for_label }}">üë§ –ò–º—è:</label>
            {{ user_form.name }}
            {% if user_form.name.errors %}
                <ul class="errorlist">
                    {% for error in user_form.name.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ user_form.email.id_for_label }}">üìß Email:</label>
            {{ user_form.email }}
            {% if user_form.email.errors %}
                <ul class="errorlist">
                    {% for error in user_form.email.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ user_form.phone.id_for_label }}">üì± –¢–µ–ª–µ—Ñ–æ–Ω:</label>
            {{ user_form.phone }}
            {% if user_form.phone.errors %}
                <ul class="errorlist">
                    {% for error in user_form.phone.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ user_form.age.id_for_label }}">üéÇ –í–æ–∑—Ä–∞—Å—Ç:</label>
            {{ user_form.age }}
            {% if user_form.age.errors %}
                <ul class="errorlist">
                    {% for error in user_form.age.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
        
        <div class="actions">
            <button type="submit" class="btn btn-success" id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            <a href="{% url 'user_profile' user.id %}" class="btn btn-secondary">‚ùå –û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

<script>
// –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('editForm');
    const saveBtn = document.getElementById('saveBtn');
    
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ñ–æ—Ä–º–µ
    let hasChanges = false;
    const inputs = form.querySelectorAll('input');
    
    inputs.forEach(input => {
        input.addEventListener('change', function() {
            hasChanges = true;
            saveBtn.style.background = 'linear-gradient(45deg, #ff9800, #f57c00)';
            saveBtn.innerHTML = '‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
        });
    });
    
    form.addEventListener('submit', function(e) {
        if (!hasChanges) {
            if (!confirm('‚ÑπÔ∏è –í—ã –Ω–µ –≤–Ω–µ—Å–ª–∏ –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                e.preventDefault();
                return;
            }
        }
        
        saveBtn.innerHTML = '‚è≥ –°–æ—Ö—Ä–∞–Ω—è–µ–º...';
        saveBtn.disabled = true;
        
        setTimeout(() => {
            saveBtn.innerHTML = '‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
            setTimeout(() => {
                saveBtn.innerHTML = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
                saveBtn.disabled = false;
                hasChanges = false;
            }, 1000);
        }, 1500);
    });
    
    // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
    window.addEventListener('beforeunload', function(e) {
        if (hasChanges) {
            e.preventDefault();
            e.returnValue = '‚ö†Ô∏è –£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–π—Ç–∏?';
        }
    });
});
</script>
{% endblock %}